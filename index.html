<!--
    ScribbleX -- Static Web Builder

    Developer Name: Kshitij S. Tyagi
    Contact: info@scribblex.net
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv='cache-control' content='no-cache'>
    <meta http-equiv='expires' content='0'>
    <meta http-equiv='pragma' content='no-cache'>
    
    <!--
        TITLE OF THE APP
    -->
    <title>
        web sandbox | scribbleX
    </title>
    <!--
        ==================================================================================================================
    -->

    <!--  CSS FILES LINKED HERE  -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/scrollbar.css">
    <link rel="stylesheet" href="css/input_color.css">
    <!--
        ==================================================================================================================
    -->

    <!--  FAVICON FILE LINKED HERE  -->
    <link rel="icon" type="image/x-icon" href="assets/fav/kt23.ico">

    
    <!--  JS LIBRARIES AND SCRIPTS  -->
    <script src="js/libraries/jQuery.js"></script>
    <script src="js/libraries/split.js"></script>
    <script src="js/libraries/sweetalert.js"></script>
    
    <script src="js/codemirror/lib/codemirror.js"></script>
    <script src="js/ace-builds-master/src/ace.js"></script>
    <script src="js/ace-builds-master/src/ext-language_tools.js"></script>
    <script src="js/ace-builds-master/src/mode-javascript.js"></script>

    <script src="js/src/init.js"></script>
    <script src="https://scripts.scribblex.net/mType_manager.js"></script>
    <!--<script src="js/src/builder_gui.js"></script>-->


    <!--    ==================  -->

    <script src="js/codemirror/addon/fold/xml-fold.js"></script>
    <script src="js/codemirror/addon/fold/foldcode.js"></script>
    <script src="js/codemirror/addon/fold/foldgutter.js"></script>
    <script src="js/codemirror/addon/fold/brace-fold.js"></script>
    <script src="js/codemirror/addon/fold/comment-fold.js"></script>
    <script src="js/codemirror/addon/fold/markdown-fold.js"></script>
    <script src="js/codemirror/addon/fold/indent-fold.js"></script>
    <script src="js/codemirror/addon/edit/closebrackets.js"></script>
    <script src="js/codemirror/addon/edit/closetag.js"></script>
    <script src="js/codemirror/addon/edit/matchbrackets.js"></script>
    <script src="js/codemirror/addon/edit/matchtags.js"></script>
    <script src="js/codemirror/addon/dialog/dialog.js"></script>
    <script src="js/codemirror/addon/search/jump-to-line.js"></script>
    <script src="js/codemirror/addon/search/matchesonscrollbar.js"></script>
    <script src="js/codemirror/addon/search/search.js"></script>
    <script src="js/codemirror/addon/search/searchcursor.js"></script>
    <script src="js/codemirror/addon/search/match-highlighter.js"></script>
    <script src="js/codemirror/addon/scroll/annotatescrollbar.js"></script>



    <script src="js_libs/codemirror/mode/css/css.js"></script>
    <script src="js_libs/codemirror/mode/htmlmixed/htmlmixed.js"></script>
    <script src="js_libs/codemirror/mode/javascript/javascript.js"></script>
    <script src="js_libs/codemirror/mode/xml/xml.js"></script>


    <link rel="stylesheet" href="js/codemirror/addon/fold/foldgutter.css">
    <link rel="stylesheet" href="js/codemirror/addon/dialog/dialog.css">
    <link rel="stylesheet" href="js/codemirror/addon/search/matchesonscrollbar.css">
    <link rel="stylesheet" href="css/codemirror.css">
    <!--
        ==================================================================================================================
    -->
    <style>
        @font-face {
            font-family: 'terminal';
            src: url('assets/');
            src: url('assets/?#iefix') format('embedded-opentype'),
                url('assets/fonts/terminal/terminal.woff2') format('woff2'),
                url('assets/fonts/terminal/terminal.woff') format('woff'),
                url('assets/fonts/terminal/terminal.ttf') format('truetype'),
            url('assets/fonts/terminal/terminal.svg#fonts/terminal/terminal') format('svg');
        }
    </style>

    <script>
        function get_db(db_name){
            // grab the value here from the browser and return the required value
            let name = db_name + "=";
            let decodeCookie = decodeURIComponent(document.cookie);
            let ca = decodeCookie.split(';');
            for(let i=0; i<ca.length; i++){
                let c = ca[i];
                while(c.charAt(0) == ' '){
                    c = c.substring(1);
                }
                if(c.indexOf(name) == 0){
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function check_db(){
            let username = get_db("username");
            if(username != ""){
                // Call the respective commands/function(s) here if cookie is available
                document.getElementById("connect_user").removeAttribute("onclick");
                document.getElementById("connect_user").setAttribute("onclick", "db_exist();");
                //alert("Cookie There");
                //alert(username);
            }
            else{
                // Cookie is not created. Call the respective function(s)/commands
                
                //alert("Cookie Not There");
            }
        }

        function create_db(db_name, db_val, time){
            // create cookie
            // FOllow the way below

            // db_name = db_val;
            const date = new Date();
            date.setTime(date.getTime() + (time*24*60*60*1000));
            let expires = "expires="+ date.toUTCString();
            document.cookie = db_name + "=" + db_val + ";" + expires + ";domain=scribblex.net; path=/";
        }
    </script>

</head>
<body onload="init();" onresize="init();">
    <script>
        //  ON DETECTING CRTL + SHIFT + R --> inspector()
        var isCtrlHold = false;
        var isShiftHold = false;

        $(document).keyup(function (e) {
            if (e.which == 17) //17 is the code of Ctrl button
                isCtrlHold = false;
            if (e.which == 16) //16 is the code of Shift button
                isShiftHold = false;
        });
        $(document).keydown(function (e) {
            if (e.which == 17)
                isCtrlHold = true;
            if (e.which == 16)
                isShiftHold = true;
        
            ShortcutManager(e);
        });

        function ShortcutManager(e){
            if(isCtrlHold && isShiftHold && e.which == 82){
                e.preventDefault(); //prevent browser from the default behavior
                //alert("Ctrl+R is pressed");
                inspector();
            }
        }
    </script>
    <!--
        ==================================================================================================================
    -->
    <div id="main_container">   <!--  THIS IS THE MAIN CONTAINER OF THE APP  -->
        <div id="top_header">
            &nbsp;
            <div style="width: 215px; height: 100%; display: inline-block; position: relative;"><img src="assets/logo/logox.png" alt="scribbleX"
                style="height: 70%; cursor: pointer; display: inline-block; position: absolute; top: 50%; transform: translateY(-50%);"
            ></div>
            <div id="top_headerChild1">
                <div style="height: 100%; display: inline-block;"></div>
                <div class="iconHolder_topHeader">
                    <img src="assets/icons/run_code.png" alt="" class="icon_header cursor_pointer" onclick="inspector();">
                    <span class="iconsText_header cursor_pointer" onclick="inspector();">Run</span>
                </div>
                &nbsp;&nbsp;&nbsp;
                <div class="iconHolder_topHeader">
                    <img src="assets/icons/cloud-computing.png" alt="" class="icon_header cursor_pointer">
                    <span class="iconsText_header cursor_pointer">Save</span>
                </div>
            </div>
        </div>
        <div id="appContainer">
            <div id="leftContainer" style="outline-style: solid; outline-color: rgb(127, 0, 115); outline-width: 1px; outline-offset: -2px;">
                <div id="leftContainer_inner">
                    <img src="assets/icons/user.png" alt="User" id="user_account"
                    style="width: 34px; position: absolute; bottom: 10px; margin-left: auto; margin-right: auto; right: 0; padding-right: 8px; cursor: pointer;" title="User" onclick="connect_user();">
                </div>
            </div>

            <div id="centerContainer">
                <br>
                <br>
                <div id="save_container">
                    <center>
                        <button id="save_btn" onclick="savecode();">
                            Save
                        </button>
                    </center>
                </div>
                <div style="height: 15px; width: 100%; display: block;">
                    <!--
                        EMPTY SPACE
                    -->
                </div>
                <center><div id="meta_container">
                    <input type="text"
                        placeholder="Project Name: "
                        style="display: block; background-color: transparent;
                        color: white;
                        outline: none;
                        border-top-style: none;
                        border-right-style: none;
                        border-left-style: none;
                        border-bottom-color: purple;"
                        id="name" autocomplete="off"
                    >
                </div></center>
            </div>

            <div id="center_right_appContainer_gutter"></div>

            <div id="rightContainer">
                <div id="top_appContainer">
                    <div class="splitView_Tools">
                        <div id="toolsPanel" style="min-width: 10px;">
                            <div id="toolsPanel_header">
                                <div style="height: 100%; width: 7px; position: relative; display: inline-block;" class="noWrap"></div>
                                <div style="height: 100%; width: 20px; position: relative; display: inline-block;" class="noWrap">
                                    <img src="assets/icons/tools.png" alt="" style="position: absolute; height: 18px; top: 50%; transform: translateY(-50%); cursor: pointer;" title="Builder Tools" id="builderTools_icon" onclick="bt_launch();">
                                </div>
                                <div style="height: 100%; width: 7px; position: relative; display: inline-block;" class="noWrap"></div>
                                <div style="height: 100%; width: 20px; position: relative; display: inline-block;" class="noWrap">
                                    <img src="assets/icons/color-palette.png" alt="" style="position: absolute; height: 18px; top: 50%; transform: translateY(-50%); cursor: pointer;" title="Color Palette" id="colorPallete_icon" onclick="clrP_launch();">
                                </div>
                            </div>
                            <div id="toolsPanel_container" style="color: white;">
                                <!--<div style="display: inline-block; height: 100%; width: 5px;"></div>-->
                                <!--<button id="GUIEditor_Button">GUI Editor</button>-->
                                <!-- onclick="activateGUIEditor();" -->
                                <!--<span id="GUIEditor_stat">OFF</span>-->
                                <!--
                                <script>
                                    document.getElementById("GUIEditor_Button").addEventListener('click', ()=>{
                                        activateGUIEditor();
                                    });
                                </script>
                                -->
                                <div style="display: inline-block; height: 100%; width: 96%; white-space: nowrap; margin-left: 10px;" id="builderTools">
                                    <br>
                                    <label for="elemHeihgt" style="font-size: 15px;">Height:</label>
                                    <input type="number" name="" id="elemHeight" step="0.01" value="" class="elemDim">
                                    <br>
                                    <br>
                                    <label for="elemWidth" style="font-size: 15px;">Width:</label>
                                    <input type="number" id="elemWidth" step="0.01" value="" class="elemDim">
                                    <br>
                                    <br>
                                    <br>
                                    <span style="font-size: 15px;">Background Color: </span><input type="color" name="" id="elemBGC" value="" onchange="bgcolor(this.value);" oninput="bgcolor(this.value);">
                                    <br>
                                    <br>
                                    <br>
                                    <span style="font-size: 15px;">Font Color: </span><input type="color" name="" id="elemFC" value="" onchange="fontColor(this.value);" oninput="fontColor(this.value);">
                                </div>
                                <!--  ===================  -->
                                <div id="colorPalette">
                                    <!--
                                        PUT THE COLOR PALETTE HERE
                                    -->
                                    Color Palette
                                </div>
                            </div>
                            <div id="toolsPanel_footer"></div>
                        </div>
                        <div id="previewContainer">
                            <div id="searchBarBrowser">
                                &nbsp;&nbsp;
                                <img src="assets/icons/1647373505088.png" alt=""
                                    style="height: 100%;
                                            display: inline-block;
                                            cursor: pointer;"
                                title="Reload Page" onclick="inspector();">
                                <div style="height: 100%; position: relative; display: inline-block; float: right; padding-right: 60px;">
                                    <img src="assets/icons/command-line.png" alt="console" style="position: absolute; height: 24px; top: 50%; transform: translateY(-50%);" class="cursor_pointer" title="console" id="console">
                                </div>
                            </div>
                            <span id="previewContainer_text">
                                <br>
                                <br>
                                <br>
                                <br>
                                <br>
                                <center>
                                    <img src="assets/logo/logox.png" alt="" style="height: 80; width: 300px;">
                                    <br>
                                    <span>
                                        Preview Frame
                                    </span>
                                </center>
                            </span>
                            <iframe frameborder="0" hspace="0" vspace="0" marginheight="0" marginwidth="0" style="display: none; background-color: white;" id="previewFrame" class="previewFrame"></iframe>
                            <script>/*
                                setInterval(run_gui, 75);

                                var temp_storage = null;

                                function run_gui(){
                                    console.log("Running...")
                                    document.getElementById("previewFrame").contentWindow.document.addEventListener('mouseover', (event)=>{
                                        event.target.style.outline = "thin solid #0000FF";
                                    });
                                    document.getElementById("previewFrame").contentWindow.document.addEventListener('mouseout', (event)=>{
                                        event.target.style.outline = "thin none #0000FF";
                                    });

                                    document.getElementById("previewFrame").contentWindow.document.addEventListener('click', (event)=>{
                                        console.log(window.getComputedStyle(event.target).backgroundColor);
                                        var abc = window.getComputedStyle(event.target).backgroundColor;
                                        abc = abc.replace("rgb(", "");
                                        abc = abc.replace(")", "");
                                        var abc_array = abc.split(', ');
                                        //alert(abc_array[0]);
                                        //alert(abc_array[1]);
                                        //alert(abc_array[2]);

                                        console.log("RGB: " + rgbToHex(parseInt(abc_array[0]), parseInt(abc_array[1]), parseInt(abc_array[2])));
                                        document.getElementById("elemBGC").value = rgbToHex(parseInt(abc_array[0]), parseInt(abc_array[1]), parseInt(abc_array[2]));

                                        temp_storage = event.target;
                                    });

                                    var getChangeBGC = document.getElementById("elemBGC").value;
                                    temp_storage.style.backgroundColor = getChangeBGC;
                                }

                                function componentToHex(c) {
                                    var hex = c.toString(16);
                                    return hex.length == 1 ? "0" + hex : hex;
                                }

                                function rgbToHex(r, g, b) {
                                    return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
                                }*/
                            </script>
                        </div>
                        <div id="devConsole" style="background-color: rgb(0, 0, 0); display: none;">
                            <div id="consoleHeader">
                                <div style="display: inline-block; height: 100%; width: 60px; position: relative; float: left;">
                                    &nbsp;&nbsp;&nbsp;<img src="assets/icons/disabled.png" alt="" id="clearConsole"
                                    title="Clear Console" style="height: 17px; top: 50%; transform: translateY(-50%); position: absolute; cursor: pointer;">
                                </div>
                                <div style="display: inline-block; height: 100%; width: 60px; position: relative; float: right;">
                                    <img src="assets/icons/cross.png" alt="" id="consoleClose"
                                    title="Close Console" style="height: 20px; top: 50%; transform: translateY(-50%); position: absolute; cursor: pointer;">
                                </div>
                            </div>
                            <div id="consoleDisplayHolder">
                                <div id="commandInput" style="position: relative;
                                    display: inline-block;
                                    border-style: none; outline: none; 
                                    font-family: monospace;
                                    width: 100%; font-size: 12px; 
                                    background-color: transparent;">
                                </div>
                            </div>

                            <!--<div id="commandInputHolder">
                                <label for="commandInput" style="font-family: 'terminal'; font-size: 20px; color: white;">&gt;_&nbsp;</label>
                                
                            </div>-->
                        </div>
                    </div>
                </div>

                <!--
                    <div id="appContainer_innerMargin"></div>
                -->

                <div id="bottom_appContainer" onresize="resizeAppFrames();">
                    <div class="splitView_Editors">
                        <div id="htmlContainer" class="splitEditor">
                            <div id="htmlHeader" class="editor_header">
                                <span style="color: red; font-size: 18px;">
                                    &nbsp;&nbsp;html.
                                </span>
                                <span style="float: right;">
                                    &nbsp;&nbsp;
                                </span>
                                <span title="New HTML"><img src="assets/icons/plus.png" alt="" style="float: right; height: 75%; cursor: pointer;"></span>
                            </div>
                            <div id="htmlEditorContainer" class="editorContainer">
                                <div id="htmlEditorChild" class="EditorChild"></div>
                            </div>
                        </div>
                        <div id="cssContainer" class="splitEditor">
                            <div id="cssHeader" class="editor_header">
                                <span style="color: blue; font-size: 18px;">
                                    &nbsp;&nbsp;css.
                                </span>
                                <span style="float: right;">
                                    &nbsp;&nbsp;
                                </span>
                                <span title="New CSS"><img src="assets/icons/plus.png" alt="" style="float: right; height: 75%; cursor: pointer;"></span>
                            </div>
                            <div id="cssEditorContainer" class="editorContainer">
                                <div id="cssEditorChild" class="EditorChild"></div>
                            </div>
                        </div>
                        <div id="jsContainer" class="splitEditor">
                            <div id="jsHeader" class="editor_header">
                                <span style="color: yellow; font-size: 18px;">
                                    &nbsp;&nbsp;js.
                                </span>
                                <span style="float: right;">
                                    &nbsp;&nbsp;
                                </span>
                                <span title="New JS"><img src="assets/icons/plus.png" alt="" style="float: right; height: 75%; cursor: pointer;"></span>
                            </div>
                            <div id="jsEditorContainer" class="editorContainer jsEditorContainer">
                                <div id="jsEditorChild" class="EditorChild"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="bottom_footer">
            <center><div style="color: rgb(136, 136, 136); font-size: 15px; font-family: 'terminal';">
                <span style="display: inline-block;">Made with </span>
                <img src="assets/icons/heart.png" alt="Love" style="width: 15px; display: inline-block;">
                <!--<span style="display: inline-block">by Kshitij S. Tyagi</span>-->
                <span> and Coffee</span>
            </div></center>
        </div>
    </div>

    <script src="js/src/script.js"></script>
    <script src="js/src/inspector.js"></script>
    <!--<script src="js/src/renderContent.js"></script>-->
    <script>
        function connect_user(){
            //var ex = check_db(); // check the cookies
            //document.getElementById("connect_user").style.display = "block";
            //document.getElementById("main_container").style.display = "none";

            var account_mgr_window = window.open("https://account.scribblex.net/", '_blank');

            var ajxCall_interval = setInterval(()=>{
                var unm = '';
                var mtp = '';

                var resp = '';
                var ajxCall = null;

                ajxCall = new XMLHttpRequest();
                ajxCall.onreadystatechange = function(){
                    //while((unm == '' && mtp == '') || (!unm.includes("scribblex:Username:") && !mtp.includes("scribblex:mtp:"))){    
                        if(this.status == 200 && this.readyState == 4){
                            resp = this.responseText;
                            var tempArr = resp.split(":://scribblex//::");
                            unm = tempArr[0];
                            unm = String(unm);
                            console.log(resp);
                            unm = unm.replace("scribblex:Username:", "");
                            mtp = tempArr[1];
                            mtp = String(mtp);
                            mtp = mtp.replace("scribblex:mtp:");

                            //create_db("username", unm, 15);
                            //create_db("member", mtp, 15);

                            console.log("DONE -> SESSION CALL MADE.");
                            if(unm != '' && mtp != ''){
                                create_db("username", unm, 15);
                                create_db("member", mtp, 15);

                                clearInterval(ajxCall_interval);
                                window.close(account_mgr_window);
                            }
                        //}
                    }
                };
                ajxCall.open("GET", "https://account.scribblex.net/getSession.php/", true);
                ajxCall.send();
            }, 5000);
        }
    </script>

    <script>
        var activeElement = "";
        document.addEventListener("click", (e)=>{
            if(e.target.id == "cmd_console"){
                activeElement = "cmd_console";
            }else{
                activeElement = String(e.target.id);
            }
        });
        var EnterPress = false;
        $(document).keydown(function(e){
            if(activeElement == "cmd_console"){
                if(e.which == 13){
                    //console.log("Enter Pressed");
                    e.preventDefault();

                    cmd_consoleMGR();
                }
            }
        });
    </script>
    <script src="js/src/cmd_console.js"></script>
</body>
</html>